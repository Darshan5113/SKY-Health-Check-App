{% extends 'engineer_base.html' %}
{% block title %}Submit Vote{% endblock %}

{% block content %}


<div class="container">
  {% if messages %}
  <div style="margin-bottom: 20px;">
      {% for message in messages %}
          <div class="alert 
              {% if message.tags == 'success' %}alert-success
              {% elif message.tags == 'error' %}alert-danger
              {% else %}alert-info{% endif %}"
              style="padding: 10px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #ccc;">
              {{ message }}
          </div>
      {% endfor %}
  </div>
{% endif %}


  <h2 class="mb-4">Cast Your Vote</h2>


  {% if existing_vote %}
    <div class="alert alert-info">
      You have already voted on this Health Card in this session. You can update your vote below.
    </div>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    <div class="mb-3">
      <label for="team" class="form-label">Select Team</label>
      <select name="team" id="team" class="form-select" required>
        <option value="" disabled {% if not existing_vote %}selected{% endif %}>-- Choose Team --</option>
        {% for team in teams %}
          <option value="{{ team.team_id }}" {% if existing_vote and existing_vote.team.team_id == team.team_id %}selected{% endif %}>
            {{ team.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label for="card" class="form-label">Select Health Card</label>
      <select name="card" id="card" class="form-select" required>
        <option value="" disabled {% if not existing_vote %}selected{% endif %}>-- Choose Health Card --</option>
        {% for card in cards %}
          <option value="{{ card.card_id }}" {% if existing_vote and existing_vote.card.card_id == card.card_id %}selected{% endif %}>
            {{ card.title }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Vote</label><br>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="vote_value" value="1" required
          {% if existing_vote and existing_vote.vote_value == 1 %}checked{% endif %}>
        <label class="form-check-label">ðŸŸ¢ Green</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="vote_value" value="2"
          {% if existing_vote and existing_vote.vote_value == 2 %}checked{% endif %}>
        <label class="form-check-label">ðŸŸ¡ Amber</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="vote_value" value="3"
          {% if existing_vote and existing_vote.vote_value == 3 %}checked{% endif %}>
        <label class="form-check-label">ðŸ”´ Red</label>
      </div>
    </div>

    <div class="mb-3">
      <label for="progress_note" class="form-label">Progress Note</label>
      <select name="progress_note" id="progress_note" class="form-select" required>
        <option value="" disabled {% if not existing_vote %}selected{% endif %}>-- Choose Progress --</option>
        <option value="Up trend" {% if existing_vote and existing_vote.progress_note == "Up trend" %}selected{% endif %}>Up trend</option>
        <option value="Down trend" {% if existing_vote and existing_vote.progress_note == "Down trend" %}selected{% endif %}>Down trend</option>
        <option value="No change" {% if existing_vote and existing_vote.progress_note == "No change" %}selected{% endif %}>No change</option>
      </select>
    </div>

    <button type="submit" class="btn btn-success">
      {% if existing_vote %}Update Vote{% else %}Submit Vote{% endif %}
    </button>
  </form>
</div>
{% endblock %}
